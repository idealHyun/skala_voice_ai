import React, { useEffect, useState } from 'react';
import { useLocation } from 'react-router-dom';
import {
  Box,
  Typography,
  Card,
  CardContent,
  Divider,
} from '@mui/material';

const mockResult = [
    {
        label: 'Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ Ï∞∏Ï¢ãÏùÄÎçîÎ≥¥Ïû•Í∞ÑÎ≥ëÎ≥¥Ìóò2504',
        probability: 0.457,
        answer:
            "Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ Ï∞∏Ï¢ãÏùÄÎçîÎ≥¥Ïû•Í∞ÑÎ≥ëÎ≥¥Ìóò2504 ÏÉÅÌíàÏùÄ 'Ïïî, ÏàòÏà†, Î≥¥ÌóòÍ∏àÏùò ÏßÄÍ∏âÏÇ¨Ïú†' ÏöîÍµ¨Î•º Ï∂©Ï°±ÌïòÎäî Ïù¥Ïú†Îäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§. Ï≤´Ïß∏, Ïù¥ Î≥¥Ìóò ÏÉÅÌíàÏùÄ Ïïî ÏßÑÎã® Ïãú Î≥¥ÌóòÍ∏àÏùÑ ÏßÄÍ∏âÌïòÎäî Ï°∞Ìï≠ÏùÑ Ìè¨Ìï®ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïù¥Îäî Ïïî ÏßÑÎã®ÏùÑ Î∞õÏùÄ Í≤ΩÏö∞ Í≤ΩÏ†úÏ†Å Î∂ÄÎã¥ÏùÑ ÎçúÏñ¥Ï§Ñ Ïàò ÏûàÎäî Ï§ëÏöîÌïú ÏöîÏÜåÏûÖÎãàÎã§. ÎëòÏß∏, ÏàòÏà† Í¥ÄÎ†® Î≥¥Ïû•ÎèÑ Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏñ¥, ÏàòÏà†Ïù¥ ÌïÑÏöîÌïú ÏÉÅÌô©ÏóêÏÑú Î∞úÏÉùÌï† Ïàò ÏûàÎäî ÏùòÎ£åÎπÑÎ•º ÏßÄÏõêÎ∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî ÏàòÏà† ÌõÑ ÌöåÎ≥µ Í∏∞Í∞Ñ ÎèôÏïàÏùò Ïû¨Ï†ïÏ†Å ÏïàÏ†ïÏùÑ ÎèÑÎ™®Ìï† Ïàò ÏûàÎäî Ïû•Ï†êÏù¥ ÏûàÏäµÎãàÎã§. ÏÖãÏß∏, Î≥¥ÌóòÍ∏à ÏßÄÍ∏âÏÇ¨Ïú†Ïóê ÎåÄÌïú Î™ÖÌôïÌïú Í∏∞Ï§ÄÏù¥ ÏÑ§Ï†ïÎêòÏñ¥ ÏûàÏñ¥, Î≥¥ÌóòÍ∏à Ï≤≠Íµ¨ Ïãú ÌòºÎûÄÏùÑ Ï§ÑÏù¥Í≥† Ïã†ÏÜçÌïú ÏßÄÍ∏âÏù¥ Í∞ÄÎä•ÌïòÎèÑÎ°ù ÏÑ§Í≥ÑÎêòÏñ¥ ÏûàÏäµÎãàÎã§.\n\nÏù¥Îü¨Ìïú Ïù¥Ïú†Î°ú Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ Ï∞∏Ï¢ãÏùÄÎçîÎ≥¥Ïû•Í∞ÑÎ≥ëÎ≥¥Ìóò2504 ÏÉÅÌíàÏùÄ ÏïîÍ≥º ÏàòÏà† Í¥ÄÎ†® Î≥¥Ïû•ÏùÑ ÌïÑÏöîÎ°ú ÌïòÎäî Í≥†Í∞ùÏóêÍ≤å Ï∂îÏ≤úÌï† ÎßåÌï©ÎãàÎã§. ÌäπÌûà, ÏïîÍ≥º ÏàòÏà†Î°ú Ïù∏Ìïú Í≤ΩÏ†úÏ†Å Î∂ÄÎã¥ÏùÑ Ï§ÑÏù¥Í≥†Ïûê ÌïòÎäî Î∂ÑÎì§ÏóêÍ≤å Ï†ÅÌï©Ìïú ÏÑ†ÌÉùÏù¥ Îê† Í≤ÉÏûÖÎãàÎã§."
    },
    {
        label: 'Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ NewÍ∞ÑÌé∏ÏïîÍ±¥Í∞ïÎ≥¥Ìóò2504(PA)',
        probability: 0.317,
        answer:
            "Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ NewÍ∞ÑÌé∏ÏïîÍ±¥Í∞ïÎ≥¥Ìóò2504(PA) ÏÉÅÌíàÏù¥ 'Ïïî, ÏàòÏà†, Î≥¥ÌóòÍ∏àÏùò ÏßÄÍ∏âÏÇ¨Ïú†' ÏöîÍµ¨Î•º Ï∂©Ï°±ÌïòÎäî Ïù¥Ïú†Îäî Îã§ÏùåÍ≥º Í∞ôÏäµÎãàÎã§. Ï≤´Ïß∏, Ïù¥ Î≥¥Ìóò ÏÉÅÌíàÏùÄ Ïïî ÏßÑÎã® Ïãú Î≥¥ÌóòÍ∏àÏùÑ ÏßÄÍ∏âÌïòÎäî Ï°∞Í±¥ÏùÑ Î™ÖÌôïÌûà ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïù¥Îäî Ïïî ÏßÑÎã® ÌôïÏ†ï Ïãú Î≥¥ÌóòÍ∏àÏù¥ ÏßÄÍ∏âÎêúÎã§Îäî Ï†êÏóêÏÑú {Ïïî}Í≥º ÏßÅÏ†ë Ïó∞Í≤∞Îê©ÎãàÎã§. ÎëòÏß∏, ÏàòÏà†Ïóê ÎåÄÌïú Î≥¥Ïû•ÎèÑ Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏñ¥, Ïïî ÏàòÏà† Ïãú Î∞úÏÉùÌïòÎäî ÎπÑÏö©ÏùÑ Î≥¥Ïû•Î∞õÏùÑ Ïàò ÏûàÏäµÎãàÎã§. Ïù¥Îäî {ÏàòÏà†}Í≥º Í¥ÄÎ†®Îêú Î∂ÄÎ∂ÑÏùÑ Ï∂©Ï°±ÏãúÌÇµÎãàÎã§. ÏÖãÏß∏, Î≥¥ÌóòÍ∏à ÏßÄÍ∏â ÏÇ¨Ïú†Ïóê ÎåÄÌïú Î™ÖÌôïÌïú Í∏∞Ï§ÄÏù¥ Ï†úÏãúÎêòÏñ¥ ÏûàÏñ¥, Î≥¥ÌóòÍ∏à ÏßÄÍ∏âÏùò Ìà¨Î™ÖÏÑ±ÏùÑ ÌôïÎ≥¥ÌïòÍ≥† ÏûàÏäµÎãàÎã§. Ïù¥Îäî {Î≥¥ÌóòÍ∏àÏùò ÏßÄÍ∏âÏÇ¨Ïú†}ÏôÄ Ïó∞Í≤∞Îê©ÎãàÎã§.\n\nÏù¥ Î≥¥Ìóò ÏÉÅÌíàÏùÄ Ïïî ÏßÑÎã®Í≥º ÏàòÏà†Ïóê ÎåÄÌïú Î≥¥Ïû•ÏùÑ ÌÜµÌï¥ Ïïî ÏπòÎ£åÏóê ÌïÑÏöîÌïú Í≤ΩÏ†úÏ†Å Î∂ÄÎã¥ÏùÑ ÎçúÏñ¥Ï§Ñ Ïàò ÏûàÎäî Ïã§ÏßàÏ†ÅÏù∏ ÌòúÌÉùÏùÑ Ï†úÍ≥µÌï©ÎãàÎã§. ÏïîÍ≥º Í¥ÄÎ†®Îêú Îã§ÏñëÌïú ÏÉÅÌô©ÏóêÏÑú Î≥¥ÌóòÍ∏àÏù¥ ÏßÄÍ∏âÎêòÎØÄÎ°ú, Ïïî ÏπòÎ£åÏóê ÎåÄÌïú Í±±Ï†ïÏùÑ ÎçúÍ≥†Ïûê ÌïòÎäî Î∂ÑÎì§ÏóêÍ≤å Ï∂îÏ≤úÌï† Ïàò ÏûàÏäµÎãàÎã§."
    },
    {
        label: 'Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ ÎÖ∏ÌõÑÏã§ÏÜêÏùòÎ£åÎπÑÎ≥¥Ìóò2504',
        probability: 0.126,
        answer:
            "Î¨∏ÏÑúÏóêÏÑú Î∞úÏ∑åÌïú ÎÇ¥Ïö©ÏùÑ Î∞îÌÉïÏúºÎ°ú \"Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ ÎÖ∏ÌõÑÏã§ÏÜêÏùòÎ£åÎπÑÎ≥¥Ìóò2504\" ÏÉÅÌíàÏù¥ 'Ïïî, ÏàòÏà†, Î≥¥ÌóòÍ∏àÏùò ÏßÄÍ∏âÏÇ¨Ïú†' ÏöîÍµ¨Î•º Ï∂©Ï°±ÌïòÎäî Ïù¥Ïú†Î•º ÏÑ§Î™ÖÌïòÍ≤†ÏäµÎãàÎã§.\n\nÏ≤´Ïß∏, {Ïïî}Í≥º Í¥ÄÎ†®ÌïòÏó¨ Ïù¥ Î≥¥Ìóò ÏÉÅÌíàÏùÄ Ïïî ÏßÑÎã® Ïãú Î≥¥ÌóòÍ∏àÏùÑ ÏßÄÍ∏âÌïòÎäî Ï°∞Ìï≠Ïù¥ Ìè¨Ìï®ÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Ïù¥Îäî Ïïî ÏßÑÎã®ÏùÑ Î∞õÏùÄ Í≤ΩÏö∞, ÌîºÎ≥¥ÌóòÏûêÍ∞Ä Í≤ΩÏ†úÏ†Å Î∂ÄÎã¥ÏùÑ Îçú Ïàò ÏûàÎèÑÎ°ù ÏÑ§Í≥ÑÎêú Í≤ÉÏûÖÎãàÎã§. Îî∞ÎùºÏÑú ÏïîÍ≥º Í¥ÄÎ†®Îêú Î≥¥ÌóòÍ∏à ÏßÄÍ∏â ÏÇ¨Ïú†Î•º Ï∂©Ï°±Ìï©ÎãàÎã§.\n\nÎëòÏß∏, {ÏàòÏà†}Ïóê ÎåÄÌïú Î∂ÄÎ∂ÑÏóêÏÑúÎäî ÏàòÏà†Ïù¥ ÌïÑÏöîÌïú Í≤ΩÏö∞ Î≥¥ÌóòÍ∏àÏù¥ ÏßÄÍ∏âÎêúÎã§Îäî Ï°∞Ìï≠Ïù¥ Î™ÖÏãúÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Ïù¥Îäî ÏàòÏà†Î°ú Ïù∏Ìïú ÏùòÎ£åÎπÑ Î∂ÄÎã¥ÏùÑ Í≤ΩÍ∞êÏãúÌÇ§Í∏∞ ÏúÑÌïú Í≤ÉÏúºÎ°ú, ÏàòÏà† Í¥ÄÎ†® Î≥¥ÌóòÍ∏à ÏßÄÍ∏â ÏÇ¨Ïú†Î•º Ï∂©Ï°±Ìï©ÎãàÎã§.\n\nÏÖãÏß∏, {Î≥¥ÌóòÍ∏àÏùò ÏßÄÍ∏âÏÇ¨Ïú†}Ïóê ÎåÄÌï¥ Ïù¥ ÏÉÅÌíàÏùÄ Î≥¥ÌóòÍ∏à ÏßÄÍ∏â Ï°∞Í±¥ÏùÑ Î™ÖÌôïÌûà Í∑úÏ†ïÌïòÍ≥† ÏûàÏúºÎ©∞, ÌîºÎ≥¥ÌóòÏûêÍ∞Ä Ìï¥Îãπ Ï°∞Í±¥ÏùÑ Ï∂©Ï°±Ìï† Í≤ΩÏö∞ Î≥¥ÌóòÍ∏àÏùÑ ÏßÄÍ∏âÌïòÎèÑÎ°ù ÏÑ§Í≥ÑÎêòÏñ¥ ÏûàÏäµÎãàÎã§. Ïù¥Îäî Î≥¥ÌóòÍ∏à ÏßÄÍ∏âÏùò Î™ÖÌôïÏÑ±Í≥º Ïã†Î¢∞ÏÑ±ÏùÑ ÎÜíÏù¥Îäî ÏöîÏÜåÏûÖÎãàÎã§.\n\nÎî∞ÎùºÏÑú \"Î¨¥Î∞∞Îãπ ÌîÑÎ¶¨ÎØ∏ÎùºÏù¥ÌîÑ ÎÖ∏ÌõÑÏã§ÏÜêÏùòÎ£åÎπÑÎ≥¥Ìóò2504\" ÏÉÅÌíàÏùÄ Ïïî ÏßÑÎã®, ÏàòÏà† ÌïÑÏöî Ïãú, Í∑∏Î¶¨Í≥† Î™ÖÌôïÌïú Î≥¥ÌóòÍ∏à ÏßÄÍ∏â Ï°∞Í±¥ÏùÑ ÌÜµÌï¥ ÌîºÎ≥¥ÌóòÏûêÏóêÍ≤å Ïã§ÏßàÏ†ÅÏù∏ ÌòúÌÉùÏùÑ Ï†úÍ≥µÌï† Ïàò ÏûàÎäî ÏÉÅÌíàÏúºÎ°ú Ï∂îÏ≤úÌï† ÎßåÌï©ÎãàÎã§. Ïù¥Îü¨Ìïú ÌäπÏÑ±ÏùÄ ÌäπÌûà ÎÖ∏ÌõÑÏóê ÏòàÏÉÅÏπò Î™ªÌïú ÏùòÎ£åÎπÑ Î∂ÄÎã¥ÏùÑ Ï§ÑÏù¥Í≥†Ïûê ÌïòÎäî Î∂ÑÎì§ÏóêÍ≤å Ï†ÅÌï©Ìï©ÎãàÎã§."
    }
];

export default function Result() {
  const [conversationData, setConversationData] = useState(null);
  const location = useLocation();
  const resultText = location.state?.result;

  useEffect(() => {
    if (!resultText) return;

    const fetchData = async () => {
      const analyzeRes = await fetch(`${process.env.REACT_APP_API_URL}/analyze`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ result: resultText }),
      });

      const analyzeJson = await analyzeRes.json();

      const predictRes = await fetch(`${process.env.REACT_APP_API_URL}/predict`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ result: resultText }),
      });

      const predictJson = await predictRes.json();

      const recommendRes = await fetch(`${process.env.REACT_APP_API_URL}/recommend/message`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ result: resultText }),
      });

      const recommendJson = await recommendRes.json();
    };

    fetchData();


  }, [resultText]);

  return (
    <Box mt={5} px={4}>
            <Typography
                variant="h5"
                gutterBottom
                sx={{
                    color: 'white',
                    backgroundColor: '#f36f21',
                    padding: '0.5rem 1rem',
                    borderRadius: 1,
                    display: 'inline-block',
                }}
            >
                Ï∂îÏ≤ú Î≥¥Ìóò ÏÉÅÌíà Í≤∞Í≥º
            </Typography>

    return (
        <Box mt={5} px={4}>
            <Box textAlign="center" mb={3}>
                <Typography
                    variant="h5"
                    gutterBottom
                    sx={{
                        color: 'white',
                        backgroundColor: '#f36f21',
                        padding: '0.5rem 1.5rem',
                        borderRadius: 1,
                        display: 'inline-block',
                    }}
                >
                    Ï∂îÏ≤ú Î≥¥Ìóò ÏÉÅÌíà Í≤∞Í≥º
                </Typography>
            </Box>

            {mockResult.map((item, index) => {
                const paragraphs = item.answer.split('\n\n');
                const last = paragraphs.pop();

                return (
                    <Card key={index} variant="outlined" sx={{ mt: 4, mb: 4, borderRadius: 4 }}>
                        <Box display="flex" justifyContent="space-between" alignItems="center" px={3} pt={2}>
                            <Typography variant="h6">{item.label}</Typography>
                            <Typography variant="subtitle2" color="text.secondary">
                                ÏòàÏ∏° ÌôïÎ•†: {(item.probability * 100).toFixed(1)}%
                            </Typography>
                        </Box>

                        <Divider sx={{ my: 1 }} />
                        <CardContent>
                            <Box sx={{ textAlign: 'justify', px: 2 }}>
                                {paragraphs.map((p, i) => (
                                    <Typography key={i} variant="body2" paragraph>
                                        {p}
                                    </Typography>
                                ))}
                                {/* Í≤∞Î°† Î¨∏Îã® */}
                                {last && (
                                    <Typography variant="body2" paragraph>
                                        <h3>üëâüèª {last}</h3>
                                    </Typography>
                                )}
                            </Box>
                        </CardContent>
                    </Card>
                );
            })}
        </Box>
    );
}
